# دليل استخدام أنماط التصميم الجديدة

## نظرة عامة
تم تطبيق نمطي **Strategy** و **Facade** في النظام لتحسين إدارة الأسعار والعمليات المعقدة.

## نمط Strategy - إدارة الأسعار الذكية

### المشكلة التي يحلها
- حساب أسعار مختلفة لأنواع العملاء المختلفة
- إضافة أنواع عملاء جديدة بدون تعديل الكود الأساسي
- فصل منطق الأسعار عن باقي النظام

### الاستراتيجيات المتاحة

#### 1. RegularPricingStrategy
- **الوصف**: للعملاء العاديين
- **خصم**: لا يوجد خصم
- **الشرط**: العميل الافتراضي

#### 2. VipPricingStrategy
- **الوصف**: للعملاء المميزين
- **خصم**: 15%
- **الشرط**: إجمالي المشتريات ≥ 100,000 أو عدد الطلبات ≥ 20

#### 3. WholesalePricingStrategy
- **الوصف**: للعملاء بالجملة
- **خصم**: 25%
- **الشرط**: عدد الطلبات ≥ 20 مع متوسط قيمة الطلب ≥ 5,000

#### 4. NewCustomerPricingStrategy
- **الوصف**: للعملاء الجدد
- **خصم**: 10%
- **الشرط**: أقل من 30 يوم منذ أول طلب

### كيفية الاستخدام

#### عبر API
```http
GET /api/pricing/calculate-price?basePrice=1000&customerName=أحمد محمد
```

#### الرد
```json
{
  "success": true,
  "data": {
    "basePrice": 1000,
    "finalPrice": 850,
    "appliedDiscount": 150,
    "strategyUsed": "VIP",
    "customerName": "أحمد محمد"
  }
}
```

## نمط Facade - العمليات التجارية المعقدة

### المشكلة التي يحلها
- تبسيط العمليات المعقدة التي تتطلب عدة خدمات
- تقليل الاعتمادية المباشرة على الخدمات الأساسية
- توفير واجهة موحدة للعمليات المعقدة

### العمليات المتاحة

#### 1. إنشاء فاتورة مبيعات ذكية
```http
POST /api/business/smart-invoice
Content-Type: application/json

{
  "invoiceNumber": "INV-001",
  "customerName": "أحمد محمد",
  "details": [
    {
      "productId": 1,
      "quantity": 2,
      "unitPrice": 1000
    }
  ]
}
```

#### 2. الحصول على تقرير أعمال شامل
```http
GET /api/business/report?startDate=2024-01-01&endDate=2024-12-31
```

#### 3. معالجة طلب منتج
```http
POST /api/business/process-order
Content-Type: application/json

{
  "productId": 1,
  "quantity": 5,
  "customerName": "أحمد محمد"
}
```

#### 4. معالجة عملية إرجاع
```http
POST /api/business/process-return
Content-Type: application/json

{
  "salesInvoiceId": 1,
  "returnItems": [
    {
      "productId": 1,
      "quantity": 1
    }
  ]
}
```

## أمثلة عملية

### مثال 1: عميل جديد
```http
GET /api/pricing/calculate-price?basePrice=500&customerName=سارة أحمد
```
**النتيجة**: سعر نهائي = 450 (خصم 10%)

### مثال 2: عميل مميز
```http
GET /api/pricing/calculate-price?basePrice=2000&customerName=محمد علي
```
**النتيجة**: سعر نهائي = 1700 (خصم 15%)

### مثال 3: عميل بالجملة
```http
GET /api/pricing/calculate-price?basePrice=3000&customerName=شركة الأمل
```
**النتيجة**: سعر نهائي = 2250 (خصم 25%)

## المزايا المحققة

### 1. قابلية الصيانة
- فصل المسؤوليات بوضوح
- سهولة إضافة استراتيجيات جديدة
- تقليل التعقيد في الكود الأساسي

### 2. قابلية التوسع
- إمكانية إضافة أنواع عملاء جديدة
- سهولة تعديل منطق الأسعار
- دعم عملاء بأحجام مختلفة

### 3. سهولة الاختبار
- اختبار كل استراتيجية منفردة
- اختبار Facade كوحدة مستقلة
- تغطية اختبارات شاملة

### 4. تحسين الأداء
- تحميل ذكي للبيانات
- حسابات محسنة
- تقليل الاستعلامات المتكررة

## خطط التطوير المستقبلية

### 1. إضافة استراتيجيات جديدة
- استراتيجية الموسمية
- استراتيجية الولاء
- استراتيجية الكميات الكبيرة

### 2. تحسين الذكاء الاصطناعي
- تحليل سلوك العملاء
- تنبؤ الطلبات المستقبلية
- تخصيص العروض

### 3. تكامل مع أنظمة خارجية
- تكامل مع أنظمة الولاء
- ربط مع أنظمة التسويق
- دمج مع أنظمة إدارة العلاقات

## ملاحظات مهمة

1. **الأمان**: جميع العمليات محمية بـ JWT Authentication
2. **الأداء**: تم تحسين الاستعلامات لتجنب مشاكل الأداء
3. **المعالجة**: تم إضافة معالجة شاملة للأخطاء
4. **التوافق**: متوافق مع البنية الحالية للنظام

## الدعم والصيانة

لأي استفسارات أو مشاكل، يرجى مراجعة:
- ملفات الكود في مجلد `Strategies`
- Controllers الجديدة
- وثائق API في Swagger UI
